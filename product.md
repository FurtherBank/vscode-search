# VS Code 查找和替换功能产品需求文档

## 1. 功能概述

本文档详细描述了一个与 VS Code 左侧标签查找和替换功能 1:1 复刻的需求。该功能允许用户在项目文件中进行全局文本搜索和替换操作，支持各种高级搜索选项，并提供直观的结果展示和导航。

## 2. 用户目标

- 快速在项目中查找指定文本
- 查找文本并进行批量或选择性替换
- 通过高级搜索选项精确定位目标内容
- 获得清晰的搜索结果并能够轻松导航

## 3. 详细功能规格

### 3.1 基础搜索功能

- **搜索输入框**
  - 支持多行文本输入
  - 支持快捷键触发和清除
  - 输入时实时显示匹配结果数量

- **替换输入框**
  - 支持单行和多行文本输入
  - 支持对搜索结果的引用（如 $1, $2 等正则表达式捕获组）

### 3.2 搜索选项

- **区分大小写**：启用/禁用大小写敏感搜索
- **全字匹配**：仅匹配作为完整单词出现的文本
- **正则表达式**：支持使用正则表达式进行搜索
- **在结果中搜索**：在已有搜索结果中进一步过滤

### 3.3 搜索范围控制

- **包含/排除文件和文件夹**
  - 支持文件扩展名过滤（如 *.js）
  - 支持目录路径过滤
  - 支持 glob 模式（如 src/**/*.ts）
  - 支持是否搜索 gitignore 命中文件的配置

### 3.4 搜索结果展示

- **树状结构显示**
  - 按文件分组展示结果
  - 显示文件相对路径
  - 显示每个文件中的匹配数量
  - 支持展开/折叠文件和目录节点

- **结果上下文**
  - 显示匹配内容的上下文行
  - 支持自定义上下文行数（结果上方行数、下方行数）
  - 高亮显示匹配的具体文本

- **状态信息**
  - 显示总匹配数
  - 显示已搜索的文件数量
  - 显示搜索状态（进行中/完成）
  - 显示搜索耗时

### 3.5 替换功能

- **全局替换**：替换所有匹配项
- **文件替换**：替换特定文件中的所有匹配项
- **选择性替换**：仅替换用户选中的匹配项
- **替换预览**：在替换前预览变更效果
- **替换撤销**：支持撤销已执行的替换操作

### 3.6 高级功能

- **多选编辑**：从搜索结果直接创建多光标编辑
- **匹配计数**：实时统计和显示匹配项数量
- **搜索排除设置**：支持通过配置排除 node_modules, .git 等目录
- **保存搜索查询**：能够保存常用搜索条件供将来使用
- **搜索中断**：允许用户中断长时间运行的搜索操作

## 4. 交互规范

### 4.1 键盘快捷键

- Ctrl+F / Cmd+F：激活搜索面板
- Alt+R / Option+R：切换到替换模式
- Ctrl+Enter / Cmd+Enter：替换所有匹配项
- Esc：关闭搜索面板
- F4 / Shift+F4：导航到下一个/上一个搜索结果
- Alt+C / Option+C：切换区分大小写选项
- Alt+W / Option+W：切换全字匹配选项
- Alt+R / Option+R：切换正则表达式选项

### 4.2 互动行为

- 点击结果项：在编辑器中打开并聚焦匹配位置
- 右键结果项：显示上下文菜单（替换此项、排除此文件等选项）
- 双击结果项：在编辑器中打开并选中匹配文本
- 搜索进行中显示进度指示器
- 搜索完成后自动滚动到首个结果

## 5. 性能需求

- 搜索操作响应时间：首次结果显示 < 100ms
- 大型项目（>10,000文件）索引和搜索优化
- 增量搜索：文件变更时实时更新结果
- 低内存占用：搜索不应导致明显的内存使用增加
- 替换大量内容时不阻塞主线程

## 6. 技术需求

- 支持 Unicode 和多语言文本搜索
- 支持各种文本编码（UTF-8, UTF-16, ASCII等）
- 支持大文件处理（>100MB）
- 支持二进制文件排除
- 支持断点续搜（搜索状态持久化）

## 7. 集成需求

- 与文件系统无缝集成
- 与版本控制系统集成（识别变更状态）
- 与编辑器设置集成（如行尾序列、制表符等）

## 8. 约束和限制

- 必须支持所有主流操作系统（Windows, macOS, Linux）
- 内存使用须适合低配置机器
- 搜索索引大小应合理，不应占用过多磁盘空间
- 替换操作必须提供撤销机制
- 必须支持离线工作模式

## 9. 未来扩展考虑

- 语义搜索支持
- 跨多项目搜索
- 云端搜索历史同步
- 基于机器学习的搜索建议
- 模糊搜索和错误容忍

## 10. 状态和错误处理

- 无匹配结果状态展示
- 搜索超时或过大处理
- 文件访问权限错误处理
- 替换操作冲突处理
- 搜索/替换历史记录管理

此产品需求文档详细描述了VS Code查找和替换功能的复刻版，专注于功能规格而非前端实现细节。